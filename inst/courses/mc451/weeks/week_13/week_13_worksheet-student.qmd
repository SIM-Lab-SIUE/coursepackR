---
title: "Week 13 Worksheet: Advanced Descriptive Statistics and Visualizations"
subtitle: "Additional Examples of Common Statistical Summaries and Plots"
format: html
editor: visual
---

> **Required Citation & Disclaimer:** Remember to include the Pew Research Center citation and disclaimer (from Lab 1) in all work that uses this data.

## Introduction

This optional worksheet provides additional examples of descriptive statistics and data visualizations beyond the main lab. Focus on measures of central tendency and variance, plus comprehensive visualization combinations.

## Setup

```{r setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(skimr)
library(ggthemes)  # For additional themes
library(mccoursepack)

# Load the new teaching data
data_path <- system.file("extdata", "ATP_W144_excerpt.csv", package = "mccoursepack")
pew_data <- read_csv(data_path)
pew_clean <- pew_data %>%
  mutate(
    gender = as_factor(GENDER),
    education = as_factor(F_EDUCCAT),
    income = as_factor(F_INC_SDT1),
    age_cat = as_factor(F_AGECAT),
    party_simple = case_when(
      F_PARTY_FINAL == "Rep/lean Rep" ~ "Republican",
      F_PARTY_FINAL == "Dem/lean Dem" ~ "Democrat",
      TRUE ~ "Independent/Other"
    ) %>% factor(levels = c("Republican", "Democrat", "Independent/Other"))
  )
```

## 1. Advanced Descriptive Statistics

### A. Measures of Central Tendency

Beyond mean and median, calculate mode and geometric mean.

```{r central-tendency}
# Function to calculate mode
get_mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

  w144_clean %>%
    summarize(
      age_mean = mean(age, na.rm = TRUE),
      age_median = median(age, na.rm = TRUE),
      age_mode = get_mode(age),
      # Geometric mean for positive values
      platform_count_geomean = exp(mean(log(platform_count[platform_count > 0]), na.rm = TRUE))
    )
```

### B. Measures of Variance and Spread

Calculate variance, standard deviation, range, IQR, and coefficient of variation.

```{r variance-measures}
  w144_clean %>%
    summarize(
      age_variance = var(age, na.rm = TRUE),
      age_sd = sd(age, na.rm = TRUE),
      age_range = max(age, na.rm = TRUE) - min(age, na.rm = TRUE),
      age_iqr = IQR(age, na.rm = TRUE),
      age_cv = sd(age, na.rm = TRUE) / mean(age, na.rm = TRUE) * 100,  # Coefficient of variation
      platform_count_sd = sd(platform_count, na.rm = TRUE)
    )
```

### C. Distribution Shape Measures

Calculate skewness and kurtosis.

```{r shape-measures}
# Custom functions for skewness and kurtosis
skewness <- function(x) {
  n <- length(x)
  mean_x <- mean(x, na.rm = TRUE)
  sd_x <- sd(x, na.rm = TRUE)
  sum((x - mean_x)^3, na.rm = TRUE) / (n * sd_x^3)
}

kurtosis <- function(x) {
  n <- length(x)
  mean_x <- mean(x, na.rm = TRUE)
  sd_x <- sd(x, na.rm = TRUE)
  sum((x - mean_x)^4, na.rm = TRUE) / (n * sd_x^4) - 3
}

  w144_clean %>%
    summarize(
      age_skewness = skewness(age),
      age_kurtosis = kurtosis(age),
      platform_count_skewness = skewness(platform_count),
      platform_count_kurtosis = kurtosis(platform_count)
    )
```

### D. Grouped Descriptive Statistics

Advanced grouped summaries with multiple measures.

```{r grouped-descriptives}
  w144_clean %>%
    filter(!is.na(ideology_simple)) %>%
    group_by(ideology_simple) %>%
    summarize(
      n = n(),
      age_mean = mean(age, na.rm = TRUE),
      age_sd = sd(age, na.rm = TRUE),
      age_min = min(age, na.rm = TRUE),
      age_max = max(age, na.rm = TRUE),
      age_q25 = quantile(age, 0.25, na.rm = TRUE),
      age_median = median(age, na.rm = TRUE),
      age_q75 = quantile(age, 0.75, na.rm = TRUE),
      platform_count_mean = mean(platform_count, na.rm = TRUE),
      platform_count_sd = sd(platform_count, na.rm = TRUE)
    )
```

## 2. Visualization Combinations

### A. One Continuous Variable

#### Histogram with Density Overlay

```{r viz-hist-density}
ggplot(w144_clean, aes(x = age)) +
  geom_histogram(aes(y = ..density..), binwidth = 5, fill = "lightblue", color = "black", alpha = 0.7) +
  geom_density(color = "red", size = 1) +
  labs(title = "Age Distribution: Histogram with Density", x = "Age", y = "Density") +
  theme_minimal()
```

#### Boxplot for Distribution Summary

```{r viz-boxplot-single}
ggplot(w144_clean, aes(x = "", y = age)) +
  geom_boxplot(fill = "lightgreen", color = "darkgreen") +
  labs(title = "Age Distribution: Boxplot", x = "", y = "Age") +
  theme_minimal() +
  coord_flip()
```

#### Violin Plot

```{r viz-violin}
ggplot(w144_clean, aes(x = "", y = age)) +
  geom_violin(fill = "purple", alpha = 0.5) +
  geom_boxplot(width = 0.1, fill = "white") +
  labs(title = "Age Distribution: Violin Plot", x = "", y = "Age") +
  theme_minimal() +
  coord_flip()
```

### B. One Discrete Variable

#### Bar Chart with Counts

```{r viz-bar-count}
ggplot(w144_clean, aes(x = party)) +
  geom_bar(fill = "steelblue") +
  labs(title = "Party Affiliation", x = "Party", y = "Count") +
  theme_minimal()
```

#### Pie Chart (Alternative to Bar)

```{r viz-pie}
w144_clean %>%
  count(party) %>%
  ggplot(aes(x = "", y = n, fill = party)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  labs(title = "Party Affiliation: Pie Chart", fill = "Party") +
  theme_void()
```

### C. Two Continuous Variables

#### Scatterplot with Trend Line

```{r viz-scatter-trend}
ggplot(w144_clean, aes(x = age, y = platform_count)) +
  geom_point(alpha = 0.6, color = "blue") +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(title = "Age vs. Platform Count", x = "Age", y = "Platform Count") +
  theme_minimal()
```

#### Scatterplot with Loess Smooth

```{r viz-scatter-loess}
ggplot(w144_clean, aes(x = age, y = platform_count)) +
  geom_point(alpha = 0.6, color = "darkgreen") +
  geom_smooth(method = "loess", color = "orange", se = FALSE) +
  labs(title = "Age vs. Platform Count (Loess)", x = "Age", y = "Platform Count") +
  theme_minimal()
```

#### Line Plot (if data were time-series)

```{r viz-line}
# Create a summary for line plot
ggplot(age_summary, aes(x = age_group, y = mean_conf, group = 1)) +
age_summary <- w144_clean %>%
  group_by(age_group = cut(age, breaks = seq(18, 80, by = 5))) %>%
  summarize(mean_platform = mean(platform_count, na.rm = TRUE))

ggplot(age_summary, aes(x = age_group, y = mean_platform, group = 1)) +
  geom_line(color = "purple", size = 1) +
  geom_point(color = "purple", size = 2) +
  labs(title = "Mean Platform Count by Age Group", x = "Age Group", y = "Mean Platform Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### D. Continuous × Discrete Variables

#### Boxplot by Group

```{r viz-boxplot-group}
ggplot(w144_clean, aes(x = ideology_simple, y = platform_count)) +
  geom_boxplot(fill = "lightcoral", color = "darkred") +
  labs(title = "Platform Count by Ideology", x = "Ideology", y = "Platform Count") +
  theme_minimal()
```

#### Violin Plot by Group

```{r viz-violin-group}
ggplot(w144_clean, aes(x = ideology_simple, y = platform_count)) +
  geom_violin(fill = "lightyellow", color = "orange") +
  geom_boxplot(width = 0.1, fill = "white") +
  labs(title = "Platform Count by Ideology: Violin", x = "Ideology", y = "Platform Count") +
  theme_minimal()
```

#### Bar Chart with Error Bars

```{r viz-bar-error}
ggplot(ideology_summary, aes(x = ideology_simple, y = mean_conf)) +
ideology_summary <- w144_clean %>%
  filter(!is.na(ideology_simple)) %>%
  group_by(ideology_simple) %>%
  summarize(
    mean_platform = mean(platform_count, na.rm = TRUE),
    se_platform = sd(platform_count, na.rm = TRUE) / sqrt(n())
  )

ggplot(ideology_summary, aes(x = ideology_simple, y = mean_platform)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  geom_errorbar(aes(ymin = mean_platform - se_platform, ymax = mean_platform + se_platform), width = 0.2) +
  labs(title = "Mean Platform Count by Ideology (with SE)", x = "Ideology", y = "Mean Platform Count") +
  theme_minimal()
```

#### Faceted Histograms

```{r viz-facet-hist}
ggplot(w144_clean, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "lightgreen", color = "black") +
  facet_wrap(~ ideology_simple) +
  labs(title = "Age Distribution by Ideology", x = "Age", y = "Count") +
  theme_minimal()
```

### E. Two Discrete Variables

#### Stacked Bar Chart

```{r viz-stacked-bar}
ggplot(w144_clean, aes(x = ideology_simple, fill = party)) +
  geom_bar(position = "stack") +
  labs(title = "Ideology vs. Party: Stacked Bar", x = "Ideology", y = "Count", fill = "Party") +
  theme_minimal()
```

#### Filled Bar Chart (Proportions)

```{r viz-filled-bar}
ggplot(w144_clean, aes(x = ideology_simple, fill = party)) +
  geom_bar(position = "fill") +
  labs(title = "Ideology vs. Party: Proportions", x = "Ideology", y = "Proportion", fill = "Party") +
  theme_minimal()
```

#### Mosaic Plot (using geom_tile)

```{r viz-mosaic}
ggplot(mosaic_data, aes(x = ideology_simple, y = view_us, fill = prop)) +
# Create contingency table
mosaic_data <- w144_clean %>%
  filter(!is.na(ideology_simple), !is.na(party)) %>%
  count(ideology_simple, party) %>%
  group_by(ideology_simple) %>%
  mutate(prop = n / sum(n))

ggplot(mosaic_data, aes(x = ideology_simple, y = party, fill = prop)) +
  geom_tile() +
  geom_text(aes(label = round(prop, 2)), color = "white") +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(title = "Ideology vs. Party: Mosaic Plot", x = "Ideology", y = "Party", fill = "Proportion") +
  theme_minimal()
```

### F. Three Variables (Continuous × Continuous × Discrete)

#### Scatterplot with Color Coding

```{r viz-scatter-color}
ggplot(w144_clean, aes(x = age, y = platform_count, color = ideology_simple)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Age vs. Platform Count by Ideology", 
    x = "Age", y = "Platform Count", color = "Ideology") +
  theme_minimal()
```

#### Faceted Scatterplots

```{r viz-facet-scatter}
ggplot(w144_clean, aes(x = age, y = platform_count)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", color = "red") +
  facet_wrap(~ ideology_simple) +
  labs(title = "Age vs. Platform Count by Ideology (Faceted)", 
    x = "Age", y = "Platform Count") +
  theme_minimal()
```

## 3. Advanced Visualization Techniques

### A. Combining Multiple Geoms

```{r viz-multi-geom}
ggplot(w144_clean, aes(x = ideology_simple, y = platform_count)) +
  geom_violin(fill = "lightgray", alpha = 0.5) +
  geom_boxplot(width = 0.1, fill = "white") +
  geom_jitter(alpha = 0.3, color = "blue", width = 0.2) +
  labs(title = "Platform Count by Ideology: Multi-Geom", 
    x = "Ideology", y = "Platform Count") +
  theme_minimal()
```

### B. Custom Themes and Colors

```{r viz-custom-theme}
ggplot(w144_clean, aes(x = age)) +
  geom_histogram(binwidth = 5, fill = "darkorange", color = "white") +
  labs(title = "Age Distribution", x = "Age", y = "Count") +
  theme_economist()  # Using ggthemes
```

## Practice Exercises

1.  Calculate additional measures of central tendency (harmonic mean, trimmed mean) for age.

2.  Create a summary table showing skewness and kurtosis for all continuous variables.

3.  Generate a correlation plot (scatterplot matrix) for age, conf_biden, conf_putin, and conf_xi.

4.  Create a heatmap showing the relationship between education levels and confidence scores.

5.  Experiment with different color palettes and themes for the visualizations above.

6.  Create a time-series style plot using age groups as "time" periods.